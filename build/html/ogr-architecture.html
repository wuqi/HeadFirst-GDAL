

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OGR矢量结构 &mdash; headfirst gdal 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="headfirst gdal 0.1 documentation" href="index.html"/>
        <link rel="next" title="OGR投影简介" href="ogr-proj.html"/>
        <link rel="prev" title="静态编译" href="static-build.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> headfirst gdal
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">影像是什么</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-data-model.html">GDAL数据模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-and-write.html">栅格数据读写</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-utilities.html">GDAL工具集</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-tool-code.html">GDAL工具集代码实现(C/C++)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-cheat-sheet.html">GDAL Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-warp-api-tutorial.html">GDALWarp</a></li>
<li class="toctree-l1"><a class="reference internal" href="static-build.html">静态编译</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">OGR矢量结构</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vector">OpenGIS中矢量要素简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ogroverview">OGR类总览</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geometry">几何形状</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spatialreference">空间参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature">要素/要素类定义</a></li>
<li class="toctree-l2"><a class="reference internal" href="#layer">图层</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasource">数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ogrdirver">驱动</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ogr-proj.html">OGR投影简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-read-write.html">矢量数据读写</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-sql.html">OGR SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="sqlite-sql.html">SQLite SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-utilities.html">OGR工具集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">headfirst gdal</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>OGR矢量结构</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ogr-architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ogr">
<span id="ograrchitecture"></span><h1>OGR矢量结构<a class="headerlink" href="#ogr" title="Permalink to this headline">¶</a></h1>
<p>本章主要介绍OGR中矢量类型的架构,与 <a class="reference internal" href="gdal-data-model.html#gdaldatamodel"><span class="std std-ref">GDAL数据模型</span></a> 一节类似,主要讲解OGR中矢量的整体结构，和其中涉及到的类，OGR设计是参照OpenGIS中的简单要素模型，因此本章中会简单介绍一些OpenGIS中的内容。本章节主要是对应 <code class="docutils literal"><span class="pre">GDAL1.11</span></code> 以下版本， <code class="docutils literal"><span class="pre">GDAL2.0</span></code> 以上版本中，将 <a class="reference internal" href="#ogrdirver"><span class="std std-ref">驱动</span></a> 修改为 <code class="docutils literal"><span class="pre">GDALDriver</span></code> ，将 <a class="reference internal" href="#datasource"><span class="std std-ref">数据源</span></a> 修改为 <code class="docutils literal"><span class="pre">GDALDataset</span></code> ，其他没有明显变化和修改。本章主要参考 <a class="reference external" href="http://gdal.org/1.11/ogr/ogr_arch.html">OGR Architecture</a> ， <a class="reference external" href="http://lab.osgeo.cn/7124.html">OpenGIS的一些基本概念</a> 。</p>
<div class="section" id="vector">
<span id="id1"></span><h2>OpenGIS中矢量要素简介<a class="headerlink" href="#vector" title="Permalink to this headline">¶</a></h2>
<p>OpenGIS定义了一组基于数据的服务，而数据的基础是要素 <code class="docutils literal"><span class="pre">Feature</span></code> 。所谓要素，简单地说就是一个独立的对象，在地图中可能表现为一个多边形建筑物，在数据库中即一个独立的条目。要素具有两个必要的组成部分，几何信息和属性信息。</p>
<p>OpenGIS将几何信息分为点、边缘、面和几何集合四种：其中我们熟悉的线 <code class="docutils literal"><span class="pre">Linestring</span></code> 属于边缘的一个子类，而多边形 <code class="docutils literal"><span class="pre">Polygon</span></code> 是面的一个子类。也就是说OpenGIS定义的几何类型并不仅仅是我们常见的点、线、多边形三种，它提供了更复杂更详细的定义，增强了未来的可扩展性。另外，几何类型的设计中采用了组合模式 <code class="docutils literal"><span class="pre">Composite</span></code> ，将几何集合 <code class="docutils literal"><span class="pre">GeometryCollection</span></code> 也定义为一种几何类型，类似地，要素集合 <code class="docutils literal"><span class="pre">FeatureCollection</span></code> 也是一种要素。属性信息没有做太大的限制，可以在实际应用中结合具体的实现进行设置。</p>
<p>相同的几何类型、属性类型的组合成为要素类型 <code class="docutils literal"><span class="pre">FeatureType</span></code> ，要素类型相同的要素可以被存放在一个数据源中。而一个数据源只能拥有一个要素类型。因此，可以用要素类型来描述一组属性相似的要素。在面向对象的模型中，完全可以把要素类型理解为一个类，而要素则是类的实例。</p>
<p>实际理解中，可以将数据源理解为一个数据库，有多个图层，每个图层相当于一张数据表，每个数据表中有一个字段存储几何数据( OGR 1.11以后可以有多个几何数据字段)，其他字段中存储该数据的属性，如下图所示：</p>
<div class="figure align-center">
<img alt="vector structS" src="_images/vector.png" />
</div>
</div>
<div class="section" id="ogroverview">
<span id="id2"></span><h2>OGR类总览<a class="headerlink" href="#ogroverview" title="Permalink to this headline">¶</a></h2>
<p>总体结构如下所示：</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Geometry</span></code> 几何形状： <code class="docutils literal"><span class="pre">OGRGeometry</span></code> 类以及其子类封装了OpenGIS模型中矢量数据，提供了一些几何操作，以及转换为WKB、WKT的操作，每个几何形状中包含有空间参考系统（投影）。</li>
<li><code class="docutils literal"><span class="pre">Spatial</span> <span class="pre">Reference</span></code> 空间参考：<code class="docutils literal"><span class="pre">OGRSpatialReference</span></code> 类封装了投影和水准面。</li>
<li><code class="docutils literal"><span class="pre">Feature</span></code> 要素： <code class="docutils literal"><span class="pre">OGRFeature</span></code> 类封装一个要素，包括其几何形状和其他属性信息</li>
<li><code class="docutils literal"><span class="pre">Feature</span> <span class="pre">Class</span> <span class="pre">Definition</span></code> 要素类定义: <code class="docutils literal"><span class="pre">OGRFeatureDefn</span></code> 类通常存储整个图层的属性的元数据</li>
<li><code class="docutils literal"><span class="pre">Layer</span></code> 图层： <code class="docutils literal"><span class="pre">OGRLayer</span></code> 表示一个图层，同类型要素的集合</li>
<li><code class="docutils literal"><span class="pre">Data</span> <span class="pre">Source</span></code> 数据源： <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 表示存储矢量数据的文件或数据库对象</li>
<li><code class="docutils literal"><span class="pre">Drivers</span></code> 驱动： <code class="docutils literal"><span class="pre">OGRSFDriver</span></code> 每个驱动可以可以打开对应类型的数据，转换为数据源，通过  <code class="docutils literal"><span class="pre">OGRSFDriverRegistrar</span></code> 管理。</li>
</ul>
</div>
<div class="section" id="geometry">
<span id="id3"></span><h2>几何形状<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h2>
<p>几何形状类用于表示各种几何矢量。它的派生类包括了各种形状，有如下类型： <code class="docutils literal"><span class="pre">OGRPoint</span></code> , <code class="docutils literal"><span class="pre">OGRLineString</span></code> , <code class="docutils literal"><span class="pre">OGRPolygon</span></code> , <code class="docutils literal"><span class="pre">OGRGeometryCollection</span></code> , <code class="docutils literal"><span class="pre">OGRMultiPolygon</span></code> , <code class="docutils literal"><span class="pre">OGRMultiPoint</span></code> ,  <code class="docutils literal"><span class="pre">OGRMultiLineString</span></code> ，其派生关系如下：</p>
<div class="figure align-center" id="id9">
<img alt="vector structS" src="_images/classOGRGeometry.png" />
<p class="caption"><span class="caption-text"><strong>OGRGeometry 类</strong></span></p>
</div>
<p><a class="reference internal" href="#ograrchitecture"><span class="std std-ref">OGR矢量结构</span></a> 中提到，OGR设计参照的是OpenGIS中的简单要素模型，下面就是OpenGIS规范中的设计：</p>
<div class="figure align-center" id="id10">
<img alt="vector structS" src="_images/opengis_geometry.png" />
<p class="caption"><span class="caption-text"><strong>OpenGIS Geometry 描述</strong></span></p>
</div>
<p><code class="docutils literal"><span class="pre">OGRCurve</span></code> 、 <code class="docutils literal"><span class="pre">OGRSurface</span></code> 两个中间抽象基类抽象出一些公用的功能，当前在简单要素模型中的一些中间基类没有出现在OGR中，以后可能会改变。</p>
<p><code class="docutils literal"><span class="pre">OGRGeometryFactory</span></code> 类用于将 <code class="docutils literal"><span class="pre">WKT</span></code> 或 <code class="docutils literal"><span class="pre">WKB</span></code> 串转化为几何形状。</p>
<p><code class="docutils literal"><span class="pre">OGRGeometry</span></code> 包含 <code class="docutils literal"><span class="pre">OGRSpatialReference</span></code> 的引用，用于定义几何形状的空间参考。</p>
<p>很多分析功能暂时没有在 <code class="docutils literal"><span class="pre">OGRGeometry</span></code> 中实现。</p>
<p>虽然理论上可以从现有的 <code class="docutils literal"><span class="pre">OGRGeometry</span></code> 类中派生出更多的其他几何形状，但是目前没有成熟方案。而且，可以使用 <code class="docutils literal"><span class="pre">OGRGeometryFactory</span></code> 创建特殊几何形状而不用修改它。</p>
</div>
<div class="section" id="spatialreference">
<span id="id4"></span><h2>空间参考<a class="headerlink" href="#spatialreference" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OGRSpatialReference</span></code> 类用于实现OpenGIS空间参考系统定义。目前已经支持本地坐标系、地理坐标系、投影坐标系、垂直坐标系、地心坐标系、复合坐标系。</p>
<p>空间坐标系统是从OpenGIS定义的WKT投影格式中继承的。其中简单模式在``Simple Features specifications`` 中定义，复杂模式在 <code class="docutils literal"><span class="pre">Coordinate</span> <span class="pre">Transformation</span> <span class="pre">specification</span></code> 中定义， <code class="docutils literal"><span class="pre">OGRSpatialReference</span></code> 类实现是建立在 <code class="docutils literal"><span class="pre">Coordinate</span> <span class="pre">Transformation</span> <span class="pre">specification</span></code> 模式上，但是兼容早期的简单模式。</p>
<p><code class="docutils literal"><span class="pre">OGRCoordinateTransformation</span></code> 类使用 <code class="docutils literal"><span class="pre">PROJ.4</span></code> 库实现坐标转换。请参照坐标转换相关内容。</p>
</div>
<div class="section" id="feature">
<span id="id5"></span><h2>要素/要素类定义<a class="headerlink" href="#feature" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OGRFeature</span></code> 保存几何形状和其属性、ID、要素类标识符。从 OGR1.11开始，要素中可以有多个几何形状字段。</p>
<p><code class="docutils literal"><span class="pre">OGRFeatureDefn</span></code> 用于表示要素属性的类型、名称等元数据信息。一个 <code class="docutils literal"><span class="pre">OGRFeatureDefn</span></code> 通常用于表示一个图层的要素属性信息。具有相同要素类定义的要素通过引用计数的方式共享同一个要素类定义。</p>
<p>要素ID（FID）在图层中是唯一的，用于标识。单独的要素或者还未写入图层的要素可能有空FID，在OGR中FID用长整型表示，而其他模型中并不一定，例如GML中用字符串表示，而Oracle中行ID比长整型要大。</p>
<p>要素类中包含几何类型（使用 <code class="docutils literal"><span class="pre">OGRFeatureDefn::GetGeomType()</span></code> 获取 <code class="docutils literal"><span class="pre">OGRwkbGeometryType</span></code> ），如果是wkbUnknown类型，那么该要素中可以添加任意类型的几何形状。这意味着一个图层中可以有不同的几何形状。</p>
<p>从 <code class="docutils literal"><span class="pre">OGR</span> <span class="pre">1.11</span></code> 开始，要素允许有多个几何字段，每个几何字段可以有不同的类型值和不同的空间参考系统。</p>
<p><code class="docutils literal"><span class="pre">OGRFeatureDefn</span></code> 包含要素类名称，通常作为图层名称。</p>
</div>
<div class="section" id="layer">
<span id="id6"></span><h2>图层<a class="headerlink" href="#layer" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OGRLayer</span></code> 表示数据源中的一层要素，同一图层的要素有相同的属性， <code class="docutils literal"><span class="pre">OGRLayer</span></code> 中也包含从数据源中读写要素的方法。图层主要用于在数据源中读写数据，通常代表一个文件，或者是空间表。</p>
<p><code class="docutils literal"><span class="pre">OGRLayer</span></code> 有顺序和随机读写方法， <code class="docutils literal"><span class="pre">GetNextFeature</span></code> 方法可以顺序读取所有要素，可以使用 <code class="docutils literal"><span class="pre">SetSpatialFilter</span></code> 等滤波器限定该方法获取的要素范围。</p>
<p>当前 <code class="docutils literal"><span class="pre">OGR</span></code> 有一个缺陷：一个图层只能设置一个空间滤波器，以后将引入 <code class="docutils literal"><span class="pre">OGRLayerView</span></code> 或其他方式来改进。</p>
<p><code class="docutils literal"><span class="pre">OGRLayer</span></code> 和 <code class="docutils literal"><span class="pre">OGRFeatureDefn</span></code> 虽然是一一对应的关系，但是设计为两个类的原因如下：</p>
<blockquote>
<div><ol class="arabic simple">
<li>OGRFeatureDefn 和 OGRFeature 并不依赖于 OGRLayer ，因此两者可以独立存在于内存中。</li>
<li>SF CORBA模型与SFCOM 和 SFSQL 不同，并没有图层与固定属性列的概念，在OGR中实现SFCORBA需要考虑这些。</li>
</ol>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">OGRLayer</span></code> 是一个抽象类，每个驱动将单独实现， <code class="docutils literal"><span class="pre">OGRLayers</span></code> 通常都由 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 直接创建，而不能直接初始化或者删除。</p>
</div>
<div class="section" id="datasource">
<span id="id7"></span><h2>数据源<a class="headerlink" href="#datasource" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OGRDataSource</span></code> 表示 <code class="docutils literal"><span class="pre">OGRLayer</span></code> 对象集合。通常代表单个文件、一系列文件、数据库或者网关。 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 通常拥有 <code class="docutils literal"><span class="pre">OGRLayer</span></code> 列表，可以返回它们的引用。</p>
<p><code class="docutils literal"><span class="pre">OGRDataSource</span></code> 是抽象基类，将有每个格式的驱动实现， <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 对象通常由对应的 OGRSFDriver 实例化，删除 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 对象仅是关闭其对数据源的访问，而非物理删除数据源。</p>
<p><code class="docutils literal"><span class="pre">OGRSFDriver</span></code> 可以通过 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 的名称(通常为文件名)重新打开数据源。</p>
<p><code class="docutils literal"><span class="pre">OGRDataSource</span></code> 可以通过 <code class="docutils literal"><span class="pre">ExecuteSQL</span></code> 方法执行对数据源的特殊命令，例如用SQL进行查询，虽然一些数据源底层支持空间SQL操作，OGR也实现了对任意数据源的查询操作（SQL的子集）。</p>
</div>
<div class="section" id="ogrdirver">
<span id="id8"></span><h2>驱动<a class="headerlink" href="#ogrdirver" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">OGRSFDriver</span></code> 用于将对应格式的文件对象实例化， <code class="docutils literal"><span class="pre">OGRSFDriverRegistrar</span></code> 用于注册各种驱动。每个格式有对应的派生类来实例化 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 和 <code class="docutils literal"><span class="pre">OGRLayer</span></code> 。</p>
<p>在应用程序启动时需要调用所需文件格式的驱动，这些函数实例化对应的驱动对象，通过 <code class="docutils literal"><span class="pre">OGRSFDriverRegistrar</span></code> 注册。当数据源打开时，<code class="docutils literal"><span class="pre">OGRSFDriverRegistrar</span></code> 将遍历使用所有的驱动，直到成功返回 <code class="docutils literal"><span class="pre">OGRDataSource</span></code> 对象。</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ogr-proj.html" class="btn btn-neutral float-right" title="OGR投影简介" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="static-build.html" class="btn btn-neutral" title="静态编译" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
  <br/>
  <br/>
  <!-- UY BEGIN -->
  <div id="uyan_frame"></div>
  <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1858308"></script>
  <!-- UY END -->
  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2017, wuqi.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>