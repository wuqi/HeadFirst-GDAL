

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>静态编译 &mdash; headfirst gdal 0.1 documentation</title>
  

  
  
  
  
    <link rel="canonical" href="hiw1hhgstatic-build.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="OGR矢量结构" href="ogr-architecture.html" />
    <link rel="prev" title="GDALWarp" href="gdal-warp-api-tutorial.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> headfirst gdal
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">前言</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">影像是什么</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-data-model.html">GDAL数据模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="read-and-write.html">栅格数据读写</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-utilities.html">GDAL工具集</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-tool-code.html">GDAL工具集代码实现(C/C++)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-alg.html">GDAL算法简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-cheat-sheet.html">GDAL Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal-warp-api-tutorial.html">GDALWarp</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">静态编译</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">编译环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="#libexpat">libexpat</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">编译前准备</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#libcurl">libcurl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hdf4">hdf4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4"><code class="docutils literal"><span class="pre">4.2.11</span></code> 以及之前版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5"><code class="docutils literal"><span class="pre">4.2.12</span></code> 之后版本</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hdf5">hdf5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6"><code class="docutils literal"><span class="pre">5.1.8.17</span></code> 之前版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8"><code class="docutils literal"><span class="pre">5.1.8.17</span></code> 之后的老版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10"><code class="docutils literal"><span class="pre">5.1.10</span></code> 版本</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#netcdf">netcdf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#netcdf4-3-0">netcdf4.3.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netcdf4-4-0">netcdf4.4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netcdf4-5-0">netcdf4.5.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#geos">geos</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proj-4">proj.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#libsqlite3">libsqlite3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#libwebp">libwebp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openjpeg">openJPEG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pcre">pcre</a></li>
<li class="toctree-l2"><a class="reference internal" href="#libkml">libKML</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spatialite">spatialite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#libiconv">libiconv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#freexl">FreeXL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libxml2">libxml2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">spatialite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id14">gdal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">编译结果下载</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ogr-architecture.html">OGR矢量结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-proj.html">OGR投影简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-read-write.html">矢量数据读写</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-sql.html">OGR SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="sqlite-sql.html">SQLite SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="ogr-utilities.html">OGR工具集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">headfirst gdal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>静态编译</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/static-build.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>静态编译<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>分享一下完全的静态编译过程，栅格数据格式加入 <code class="docutils literal"><span class="pre">hdf4</span></code> 、 <code class="docutils literal"><span class="pre">hdf5</span></code> 、 <code class="docutils literal"><span class="pre">netcdf</span></code> 、 <code class="docutils literal"><span class="pre">openJPEG</span></code> 、 <code class="docutils literal"><span class="pre">webp</span></code> 静态编译，矢量数据格式加入编译 <code class="docutils literal"><span class="pre">libexpat</span></code> 和 <code class="docutils literal"><span class="pre">libcurl</span></code> <code class="docutils literal"><span class="pre">spatialite</span></code>， <code class="docutils literal"><span class="pre">gdal</span></code> 是最新 <code class="docutils literal"><span class="pre">svn</span></code> 中编译的，其他库都是最新 <code class="docutils literal"><span class="pre">release</span></code> 版本。</p>
<p>这样编译出来的 <code class="docutils literal"><span class="pre">gdal</span></code> 只有  <code class="docutils literal"><span class="pre">gdal</span></code> 本身的 <code class="docutils literal"><span class="pre">dll</span></code> 和 <code class="docutils literal"><span class="pre">lib</span></code> ，不需要添加其他的 <code class="docutils literal"><span class="pre">dll</span></code> ，比较方便一些，且比加入其他的 <code class="docutils literal"><span class="pre">dll</span></code> 要小，有问题请直接在最下评论。</p>
<p>动态编译请参考 <a class="reference external" href="http://blog.csdn.net/liminlu0314/article/details/6937194">GDAL源码剖析（二）之编译说明</a></p>
<div class="section" id="id2">
<h2>编译环境<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>编译所需的软件：</p>
<ul class="simple">
<li><a class="reference external" href="http://www.cmake.org/">cmake</a>  根据netcdf的要求是2.8.10以上版本，用于编译 <code class="docutils literal"><span class="pre">expat</span> <span class="pre">hdf4</span> <span class="pre">hdf5</span> <span class="pre">openJPEG</span></code></li>
<li><code class="docutils literal"><span class="pre">vs2010</span></code> ，一般都使用命令行编译</li>
<li><a class="reference external" href="http://nsis.sourceforge.net/Download">nsis</a>  2.46版， 用于生成 <code class="docutils literal"><span class="pre">hdf4</span> <span class="pre">hdf5</span></code> 安装文件</li>
</ul>
<p>推荐编译顺序： <code class="docutils literal"><span class="pre">libexpat</span>&#160; <span class="pre">libcurl</span> <span class="pre">hdf4</span> <span class="pre">hdf5</span>&#160; <span class="pre">netcdf4</span> <span class="pre">geos</span> <span class="pre">proj.4</span> <span class="pre">libsqlite3</span> <span class="pre">libwebp</span> <span class="pre">openJPEG</span> <span class="pre">gdal</span></code></p>
<p>编译顺序除了注意事项中所描述的，一般可以互换。</p>
<p><code class="docutils literal"><span class="pre">netcdf</span> <span class="pre">hdf4</span> <span class="pre">hdf5</span> <span class="pre">spatialite</span></code>  这几个库编译比较复杂，请注意编译条件的修改。</p>
<p>虽然 <code class="docutils literal"><span class="pre">cmake</span></code> 可以使用 <code class="docutils literal"><span class="pre">GUI</span></code> ，推荐都使用命令行编译，命令行开头我将以 <code class="docutils literal"><span class="pre">&gt;</span></code> 标识出来,本文都是在 <code class="docutils literal"><span class="pre">Windows</span></code> 下编译， <code class="docutils literal"><span class="pre">Linux</span></code> 下没有尝试。</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>libexpat库静态编译必须设置 <code class="docutils literal"><span class="pre">XML_STATIC</span></code> 宏</li>
<li>openJPEG库静态编译后需要设置 <code class="docutils literal"><span class="pre">OPJ_STATIC</span></code> 宏</li>
<li>如果需要编译netcdf，libcurl库必须在netcdf前编译</li>
<li>netcdf与hdf4如果都需要的话，编译hdf4时必须关闭netcdf设置</li>
<li>geos库最好不用svn的版本</li>
<li>编译都假设起始目录为代码源目录</li>
<li>不要使用 <code class="docutils literal"><span class="pre">nsis3.0a1</span></code> 版本，无法生成安装文件</li>
<li>hdf5是只读驱动,但是netcdf也算hdf5格式,netcdf是读写驱动</li>
</ul>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">我编译netcdf时没有加入hdf4设置，加入后无法通过编译，如果有人解决，请在评论中留言</p>
</div>
</div>
<div class="section" id="libexpat">
<h2>libexpat<a class="headerlink" href="#libexpat" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>编译前准备<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>下载源码后，修改 <code class="docutils literal"><span class="pre">expat-2.1.0/lib/expat.h</span></code> 文件,在文件首加上：</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#define XML_STATIC</span>
</pre></div>
</div>
<p>这一步也可以在最后的生成include中修改，只要能链接就可以。</p>
<p>打开vs2010命令行，依次输入：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G   <span class="s2">&quot;Visual Studio 10&quot;</span> -DBUILD_shared<span class="o">=</span>OFF
      -DCMAKE_INSTALL_PREFIX<span class="o">=</span>E:<span class="se">\B</span>UILD<span class="se">\e</span>xpat ..
cmake --build . --config Release --target INSTALL
</pre></div>
</div>
<p>生成文件将在 <code class="docutils literal"><span class="pre">E:/BUILD/expat</span></code> 路径下</p>
</div>
</div>
<div class="section" id="libcurl">
<h2>libcurl<a class="headerlink" href="#libcurl" title="Permalink to this headline">¶</a></h2>
<p>libcurl更新比较快,1-2月更新一个版本,请选择最新的版本,可选 <code class="docutils literal"><span class="pre">openssl</span></code> 和 <code class="docutils literal"><span class="pre">zlib</span></code> 等库,最简单的编译方式如下:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> winbuild
nmake /f Makefile.vc <span class="nv">mode</span><span class="o">=</span>static
</pre></div>
</div>
<p>生成文件将在 <code class="docutils literal"><span class="pre">builds</span></code> 文件夹下.</p>
</div>
<div class="section" id="hdf4">
<h2>hdf4<a class="headerlink" href="#hdf4" title="Permalink to this headline">¶</a></h2>
<p>hdf4最终版本是 <code class="docutils literal"><span class="pre">4.2.13</span></code> ,但是自 <code class="docutils literal"><span class="pre">4.2.12</span></code> 版本起,编译方式变化很大,请阅读相应部分</p>
<div class="section" id="id4">
<h3><code class="docutils literal"><span class="pre">4.2.11</span></code> 以及之前版本<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>编辑 <code class="docutils literal"><span class="pre">/config/cmake/cacheinit.cmake</span></code> 文件：</p>
<p>设置静态库,7行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (BUILD_SHARED_LIBS OFF CACHE BOOL &quot;Build Shared Libraries&quot; FORCE)
</pre></div>
</div>
<p>关闭 <code class="docutils literal"><span class="pre">fortan</span></code> 编译,15行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (HDF4_BUILD_FORTRAN OFF CACHE BOOL &quot;Build FORTRAN support&quot; FORCE)
</pre></div>
</div>
<p>关闭 <code class="docutils literal"><span class="pre">netcdf</span></code> 支持，如果在 <code class="docutils literal"><span class="pre">gdal</span></code> 中不同时使用 <code class="docutils literal"><span class="pre">netcdf</span></code> ，可以不修改，23行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (HDF4_ENABLE_NETCDF OFF CACHE BOOL &quot;Build HDF4 versions of NetCDF-3 APIS&quot; FORCE)
</pre></div>
</div>
<p>编译 <code class="docutils literal"><span class="pre">zlib</span></code> 库和 <code class="docutils literal"><span class="pre">szip</span></code> 库,使用svn中的代码(需要联网)，49行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (HDF4_ALLOW_EXTERNAL_SUPPORT &quot;SVN&quot; CACHE STRING  \
    &quot;Allow External Library Building&quot; FORCE)
</pre></div>
</div>
<p>在 <code class="docutils literal"><span class="pre">vs2010</span></code> 命令行工具中，依次输入：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span>  -C ..<span class="se">\c</span>onfig<span class="se">\c</span>make<span class="se">\c</span>acheinit.cmake ..
cmake --build . --config Release
copy /B .<span class="se">\b</span>in<span class="se">\R</span>elease<span class="se">\l</span>ibjpeg.lib .<span class="se">\b</span>in<span class="se">\l</span>ibjpeg.lib
copy /B .<span class="se">\b</span>in<span class="se">\R</span>elease<span class="se">\l</span>ibzlib.lib .<span class="se">\b</span>in<span class="se">\l</span>ibzlib.lib
copy /B .<span class="se">\b</span>in<span class="se">\R</span>elease<span class="se">\l</span>ibszip.lib .<span class="se">\b</span>in<span class="se">\l</span>ibszip.lib
cmake --build . --config Release
cpack -C Release CPackConfig.cmake
HDF-4.2.9-win32.exe
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">cmake</span> <span class="pre">--build</span> <span class="pre">.</span> <span class="pre">--config</span> <span class="pre">Release</span></code> 运行了两次，因为hdf库的cmake写的有些问题，需要把 <code class="docutils literal"><span class="pre">libjpeg</span></code> 等库先拷贝到上一层才能完成全部的编译。</li>
<li>如果需要编译64位的话，第三行需要修改为： <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-G</span> <span class="pre">&quot;Visual</span> <span class="pre">Studio</span> <span class="pre">10</span> <span class="pre">Win64&quot;</span>&#160; <span class="pre">-C</span> <span class="pre">../config/cmake/cacheinit.cmake</span> <span class="pre">..</span></code></li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h3><code class="docutils literal"><span class="pre">4.2.12</span></code> 之后版本<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li>请注意, <code class="docutils literal"><span class="pre">4.2.12</span></code> 之后版本不需要下载原始sourcecode,下载 CMake版本代码直接编译!!</li>
</ul>
</div>
<p>参考cmake build页面: <a class="reference external" href="https://support.hdfgroup.org/release4/cmakebuild.html">cmakebuild</a></p>
<p>下载页面中的: <a class="reference external" href="https://support.hdfgroup.org/ftp/HDF/HDF_Current/src/CMake-hdf-4.2.13.zip">Contains files to build HDF4 with CMake on Windows</a> ,下载后的压缩包中包含了szip和zlib等所需库,不需要额外再下载.</p>
<p>修改其中的  <code class="docutils literal"><span class="pre">HDF4options.cmake</span></code> 文件,文件末尾添加  <code class="docutils literal"><span class="pre">set(ADD_BUILD_OPTIONS</span> <span class="pre">&quot;${ADD_BUILD_OPTIONS}</span> <span class="pre">-DHDF4_ENABLE_NETCDF:BOOL=OFF&quot;)</span></code> ,防止与 <code class="docutils literal"><span class="pre">netcdf</span></code> 库冲突</p>
<p>下载完成后,根据Visual Studio版本,运行相应的 <code class="docutils literal"><span class="pre">build-VS20xx-32.bat</span></code> 或者 <code class="docutils literal"><span class="pre">build-VS20xx-64.bat</span></code> 文件,会自动新建build文件夹,最终在 <code class="docutils literal"><span class="pre">build</span></code> 文件夹下生成zip文件.</p>
<p>老版本或者新版本的Visual Studio可直接编辑 <code class="docutils literal"><span class="pre">HDF4config.cmake</span></code> 文件,仿照其他bat文件写脚本.</p>
</div>
</div>
<div class="section" id="hdf5">
<h2>hdf5<a class="headerlink" href="#hdf5" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">hdf5</span></code> 与 <code class="docutils literal"><span class="pre">hdf4</span></code> 类似,新版本直接使用脚本文件调用 <code class="docutils literal"><span class="pre">CMake</span></code></p>
<div class="section" id="id6">
<h3><code class="docutils literal"><span class="pre">5.1.8.17</span></code> 之前版本<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>编辑 <code class="docutils literal"><span class="pre">/config/cmake/cacheinit.cmake</span></code> 文件：</p>
<p>编译静态库，7行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (BUILD_SHARED_LIBS OFF CACHE BOOL &quot;Build Shared Libraries&quot; FORCE)
</pre></div>
</div>
<p>关闭 <code class="docutils literal"><span class="pre">fortran</span></code> 库编译，17行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (HDF5_BUILD_FORTRAN OFF CACHE BOOL &quot;Build FORTRAN support&quot; FORCE)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">zlib</span></code> 和 <code class="docutils literal"><span class="pre">szip</span></code> 库支持，63行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span>SET (HDF5_ALLOW_EXTERNAL_SUPPORT &quot;SVN&quot; CACHE STRING \
    &quot;Allow External Library Building&quot; FORCE)
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last">
<li><p class="first">网络不好的情况下,可以在 <a class="reference external" href="http://www.hdfgroup.org/HDF5/release/cmakebuild.html">HDF5官网</a> 下载szip和zlib库,放在hdf5文件夹下,然后修改第63行左右为:</p>
<blockquote>
<div><p>SET (HDF5_ALLOW_EXTERNAL_SUPPORT “TGZ” CACHE STRING “Allow External Library Building” FORCE)</p>
</div></blockquote>
</li>
</ul>
</div>
<p>在 <code class="docutils literal"><span class="pre">vs2010</span></code> 命令行工具中，依次输入：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span>  -C ../config/cmake/cacheinit.cmake ..
cmake --build . --config Release
copy /B .<span class="se">\b</span>in<span class="se">\R</span>elease<span class="se">\l</span>ibzlib.lib .<span class="se">\b</span>in<span class="se">\l</span>ibzlib.lib
copy /B .<span class="se">\b</span>in<span class="se">\R</span>elease<span class="se">\l</span>ibszip.lib .<span class="se">\b</span>in<span class="se">\l</span>ibszip.lib
cmake --build . --config Release
cpack -C Release CPackConfig.cmake
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li>注意 <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">--build</span> <span class="pre">.</span> <span class="pre">--config</span> <span class="pre">Release</span></code> 运行了两次，因为hdf库的cmake写的有些问题，需要把 <code class="docutils literal"><span class="pre">libzlib</span></code> 等库先拷贝到上一层才能完成全部的编译。</li>
<li>如果需要编译64位的话，第三行需要修改为： <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-G</span> <span class="pre">&quot;Visual</span> <span class="pre">Studio</span> <span class="pre">10</span> <span class="pre">Win64&quot;</span>&#160; <span class="pre">-C</span> <span class="pre">../config/cmake/cacheinit.cmake</span> <span class="pre">..</span></code></li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">hdf5.1.8.13</span></code> 版本静态编译有问题,没有特殊需求不要使用,若使用,请删除或注释 <code class="docutils literal"><span class="pre">/hdf5-1.8.13/src/H5.c</span></code> 第841行以下的部分</li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h3><code class="docutils literal"><span class="pre">5.1.8.17</span></code> 之后的老版本<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>与 <code class="docutils literal"><span class="pre">HDF4</span></code> 类似,参考cmake build页面: <a class="reference external" href="https://support.hdfgroup.org/HDF5/release/cmakebuild518.html">cmakebuild</a> ,下载后的压缩包中包含了szip和zlib等所需库,不需要额外再下载.</p>
<p>下载页面中的: <a class="reference external" href="https://support.hdfgroup.org/ftp/HDF5/current18/src/CMake-hdf5-1.8.19.zip">Contains files to build HDF5 with CMake on Windows</a></p>
<p>下载完成后,根据Visual Studio版本,运行相应的 <code class="docutils literal"><span class="pre">build-VS20xx-32.bat</span></code> 或者 <code class="docutils literal"><span class="pre">build-VS20xx-64.bat</span></code> 文件.</p>
<p>老版本或者新版本的Visual Studio可直接编辑 <code class="docutils literal"><span class="pre">HDF5config.cmake</span></code> 文件,仿照其他bat文件写脚本.</p>
</div>
<div class="section" id="id10">
<h3><code class="docutils literal"><span class="pre">5.1.10</span></code> 版本<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><code class="docutils literal"><span class="pre">5.1.10</span></code> 是新的大版本,可以读老文件,写文件与老版本不兼容.</p>
</div>
<p>与 <code class="docutils literal"><span class="pre">HDF4</span></code> 类似,参考cmake build页面: <a class="reference external" href="https://support.hdfgroup.org/HDF5/release/cmakebuild.html">cmakebuild</a> ,下载后的压缩包中包含了szip和zlib等所需库,不需要额外再下载.</p>
<p>下载页面中的: <a class="reference external" href="https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.1/src/CMake-hdf5-1.10.1.zip">Contains files to build HDF5 with CMake on Windows</a></p>
<p>下载完成后,根据Visual Studio版本,运行相应的 <code class="docutils literal"><span class="pre">build-VS20xx-32.bat</span></code> 或者 <code class="docutils literal"><span class="pre">build-VS20xx-64.bat</span></code> 文件.</p>
<p>老版本或者新版本的Visual Studio可直接编辑 <code class="docutils literal"><span class="pre">HDF5config.cmake</span></code> 文件,仿照其他bat文件写脚本.</p>
</div>
</div>
<div class="section" id="netcdf">
<h2>netcdf<a class="headerlink" href="#netcdf" title="Permalink to this headline">¶</a></h2>
<div class="section" id="netcdf4-3-0">
<h3>netcdf4.3.0<a class="headerlink" href="#netcdf4-3-0" title="Permalink to this headline">¶</a></h3>
<p>netcdf4.3.0直接按照说明文件可以编译通过,如下所述:</p>
<p>使用 <code class="docutils literal"><span class="pre">cmake</span></code> 编译，自己根据情况修改库和 <code class="docutils literal"><span class="pre">include</span></code> , <code class="docutils literal"><span class="pre">-D</span></code> 表示配置</p>
<p>注意 <code class="docutils literal"><span class="pre">cmake</span></code> 命令是一整行</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build

<span class="nb">cd</span> build

cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>e:/build/netcdf
    -DENABLE_NETCDF_4<span class="o">=</span>ON -D<span class="s2">&quot;CURL_LIBRARY=E:/BUILD/libcurl/lib/libcurl_a.lib&quot;</span>
    -D<span class="s2">&quot;CURL_INCLUDE_DIR=E:/BUILD/libcurl/include&quot;</span>  -D<span class="s2">&quot;BUILD_SHARED_LIBS=OFF&quot;</span>
    -D<span class="s2">&quot;HDF5_LIB=E:/BUILD/hdf/1.8.11/lib/libhdf5.lib&quot;</span>
    -D<span class="s2">&quot;HDF5_HL_LIB=E:/BUILD/hdf/1.8.11/lib/libhdf5_hl.lib&quot;</span>
    -D<span class="s2">&quot;HDF5_INCLUDE_DIR=E:/BUILD/hdf/1.8.11/include&quot;</span>
    -D<span class="s2">&quot;ZLIB_LIBRARY=E:/BUILD/hdf/1.8.11/lib/libzlib.lib;</span>
<span class="s2">    E:/BUILD/hdf/1.8.11/lib/libszip.lib&quot;</span>
    -D<span class="s2">&quot;ZLIB_INCLUDE_DIR=E:/BUILD/hdf5-1.8.11/build/ZLIB-prefix/src/ZLIB&quot;</span>
    -D<span class="s2">&quot;SZIP_INCLUDE_DIR=E:/BUILD/hdf5-1.8.11/build/SZIP-prefix/src/SZIP/src&quot;</span>
    -D<span class="s2">&quot;SZIP_DIR=E:\BUILD\hdf5-1.8.11\build\SZIP-prefix\src\SZIP-build&quot;</span>
    -D<span class="s2">&quot;USE_SZIP=ON&quot;</span>   ..

 cmake --build . --config Release --target INSTALL
</pre></div>
</div>
<p>完整的命令解释：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span>                                  <span class="c1">#使用vs2010编译</span>
      -DCMAKE_INSTALL_PREFIX<span class="o">=</span>e:/build/netcdf                  <span class="c1">#安装路径</span>
      -DENABLE_NETCDF_4<span class="o">=</span>ON                                    <span class="c1">#编译netcdf4#</span>
      -D<span class="s2">&quot;CURL_LIBRARY=E:/BUILD/libcurl/lib/libcurl_a.lib&quot;</span>     <span class="c1">#curl库路径</span>
      -D<span class="s2">&quot;CURL_INCLUDE_DIR=E:/BUILD/libcurl/include&quot;</span>           <span class="c1">#curl库头文件路径</span>
      -D<span class="s2">&quot;BUILD_SHARED_LIBS=OFF&quot;</span>                               <span class="c1">#静态库</span>
      -D<span class="s2">&quot;HDF5_LIB=E:/BUILD/hdf/1.8.11/lib/libhdf5.lib&quot;</span>        <span class="c1">#hdf5库</span>
      -D<span class="s2">&quot;HDF5_HL_LIB=E:/BUILD/hdf/1.8.11/lib/libhdf5_hl.lib&quot;</span>  <span class="c1">#hdf5库</span>
      -D<span class="s2">&quot;HDF5_INCLUDE_DIR=E:/BUILD/hdf/1.8.11/include&quot;</span>        <span class="c1">#hdf5库头文件</span>
                                                              <span class="c1">#zlib库和szip库文件</span>
      -D<span class="s2">&quot;ZLIB_LIBRARY=E:/BUILD/hdf/1.8.11/lib/libzlib.lib;</span>
<span class="s2">        E:/BUILD/hdf/1.8.11/lib/libszip.lib&quot;</span>
                                                              <span class="c1">#zlib库头文件</span>
      -D<span class="s2">&quot;ZLIB_INCLUDE_DIR=E:/BUILD/hdf5-1.8.11/build/ZLIB-prefix/src/ZLIB&quot;</span>
                                                              <span class="c1">#szip库头文件</span>
      -D<span class="s2">&quot;SZIP_INCLUDE_DIR=E:/BUILD/hdf5-1.8.11/build/SZIP-prefix/src/SZIP/src&quot;</span>
                                                              <span class="c1">#szip源文件</span>
      -D<span class="s2">&quot;SZIP_DIR=E:\BUILD\hdf5-1.8.11\build\SZIP-prefix\src\SZIP-build&quot;</span>
      -D<span class="s2">&quot;USE_SZIP=ON&quot;</span>                                         <span class="c1">#使用sizp库</span>
      ..                           <span class="c1">#编译目录中cmakelist.ext文件，在上级目录中。</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li>如果需要编译64位的话，第一行需要修改为： <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-G</span> <span class="pre">&quot;Visual</span> <span class="pre">Studio</span> <span class="pre">10</span> <span class="pre">Win64&quot;</span></code></li>
</ul>
</div>
</div>
<div class="section" id="netcdf4-4-0">
<h3>netcdf4.4.0<a class="headerlink" href="#netcdf4-4-0" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<ul class="last simple">
<li>netcdf4.4.0 windows的cmake build有问题,需要修改cmake文件,详细介绍如下:</li>
</ul>
</div>
<p>netcdf4.4.0 的 <cite>cmake</cite> windows版本有问题,详细信息可参见  <a class="reference external" href="https://github.com/Unidata/netcdf-c/issues/222">github issue #222</a></p>
<p>先需要修改CMakeLists.txt,在498行 <code class="docutils literal"><span class="pre">ELSE</span></code> 前面,加入 <code class="docutils literal"><span class="pre">INCLUDE_DIRECTORIES(${HDF5_INCLUDE_DIR})</span></code></p>
<p>再修改编译命令,将 <code class="docutils literal"><span class="pre">HDF5_HL_LIB</span></code> 修改为 <code class="docutils literal"><span class="pre">HDF5_HL_LIBRARY</span></code> , <code class="docutils literal"><span class="pre">HDF5_LIB</span></code> 改为 <code class="docutils literal"><span class="pre">HDF5_C_LIBRARY</span></code> ,具体如下:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build

<span class="nb">cd</span> build

cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>d:/GDAL/netcdf4.4.0
   -D<span class="s2">&quot;HDF5_DIR=E:/lib/hdf5-1.8.16/build&quot;</span>
   -D<span class="s2">&quot;ZLIB_LIBRARY=D:/GDAL/HDF5-1.8.16-win32/lib/libzlib.lib;</span>
<span class="s2">    D:/GDAL/HDF5-1.8.16-win32/lib/libszip.lib&quot;</span>
   -D<span class="s2">&quot;ZLIB_INCLUDE_DIR=E:/BUILD/hdf5-1.8.16/build/ZLIB-prefix/src/ZLIB&quot;</span>
   -D<span class="s2">&quot;SZIP_INCLUDE_DIR=E:/BUILD/hdf5-1.8.16/build/SZIP-prefix/src/SZIP/src&quot;</span>
   -DENABLE_NETCDF_4<span class="o">=</span>ON
   -D<span class="s2">&quot;CURL_LIBRARY=D:/GDAL/libcurl-vc-x86-7.47.1/lib/libcurl_a.lib&quot;</span>
   -D<span class="s2">&quot;CURL_INCLUDE_DIR=D:/GDAL/libcurl-vc-x86-7.47.1/include&quot;</span>
   -D<span class="s2">&quot;HDF5_C_LIBRARY=D:/GDAL/HDF5-1.8.16-win32/lib/hdf5.lib&quot;</span>
   -D<span class="s2">&quot;HDF5_HL_LIBRARY=D:/GDAL/HDF5-1.8.16-win32/lib/hdf5_hl.lib&quot;</span>
   -D<span class="s2">&quot;HDF5_INCLUDE_DIR=D:/GDAL/HDF5-1.8.16-win32/include&quot;</span>
   -D<span class="s2">&quot;BUILD_SHARED_LIBS=OFF&quot;</span>   ..
</pre></div>
</div>
</div>
<div class="section" id="netcdf4-5-0">
<h3>netcdf4.5.0<a class="headerlink" href="#netcdf4-5-0" title="Permalink to this headline">¶</a></h3>
<p>使用 <code class="docutils literal"><span class="pre">cmake</span></code> 编译，自己根据情况修改库和 <code class="docutils literal"><span class="pre">include</span></code> , <code class="docutils literal"><span class="pre">-D</span></code> 表示配置，需要注意，此版本中 <code class="docutils literal"><span class="pre">HAVE_HDF5_H</span></code> 和 <code class="docutils literal"><span class="pre">SZIP</span></code> 需要单独配置，否则编译失败</p>
<p>注意 <code class="docutils literal"><span class="pre">cmake</span></code> 命令是一整行</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build

<span class="nb">cd</span> build

cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span>  -DUSE_SZIP<span class="o">=</span>ON -DUSE_HDF5<span class="o">=</span>ON -DENABLE_DAP<span class="o">=</span>ON
  -D<span class="s2">&quot;BUILD_SHARED_LIBS=OFF&quot;</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>F:/BUILD/netcdf4.5
  -D“SZIP<span class="o">=</span>F:/BUILD/HDF5-1.8.19-win32/lib/libszip.lib”
  -D<span class="s2">&quot;ZLIB_INCLUDE_DIR=F:/GDAL_BUILD/CMake-HDF5-1.8.19/build_x86/ZLIB-prefix/src/ZLIB&quot;</span>
  -D<span class="s2">&quot;ZLIB_LIBRARY=F:/BUILD/HDF5-1.8.19-win32/lib/libzlib.lib&quot;</span>
  -DENABLE_NETCDF_4<span class="o">=</span>ON -D<span class="s2">&quot;CURL_LIBRARY=F:/BUILD/libcurl-7.56.1-x84/lib/libcurl_a.lib&quot;</span>
  -D<span class="s2">&quot;CURL_INCLUDE_DIR=F:/BUILD/libcurl-7.56.1-x86/include&quot;</span>
  -D<span class="s2">&quot;HAVE_HDF5_H=F:/BUILD/HDF5-1.8.19-win32/include&quot;</span>
  -D<span class="s2">&quot;HDF5_INCLUDE_DIR=F:/BUILD/HDF5-1.8.19-win32/include&quot;</span>
  -D<span class="s2">&quot;HDF5_C_LIBRARY=F:/BUILD/HDF5-1.8.19-win32/lib/libhdf5.lib&quot;</span>
  -D<span class="s2">&quot;HDF5_HL_LIBRARY=F:/BUILD/HDF5-1.8.19-win32/lib/libhdf5_hl.lib&quot;</span> ..

 cmake --build . --config Release --target INSTALL
</pre></div>
</div>
</div>
</div>
<div class="section" id="geos">
<h2>geos<a class="headerlink" href="#geos" title="Permalink to this headline">¶</a></h2>
<p>请直接下最新的 <code class="docutils literal"><span class="pre">release</span></code> 编译， <code class="docutils literal"><span class="pre">svn</span></code> 中部分存在问题，编译不过， <code class="docutils literal"><span class="pre">geos</span></code> 直接采用 <code class="docutils literal"><span class="pre">nmake</span></code> 可以生成静态库和动态库，在 <code class="docutils literal"><span class="pre">src</span></code> 子目录下。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f Makefile.vc
</pre></div>
</div>
</div>
<div class="section" id="proj-4">
<h2>proj.4<a class="headerlink" href="#proj-4" title="Permalink to this headline">¶</a></h2>
<p>修改 <code class="docutils literal"><span class="pre">nmake.opt</span></code> 文件中32、33行:</p>
<div class="highlight-rst"><div class="highlight"><pre><span></span># Uncomment the first for linking exes against DLL or second for static
#EXE_PROJ =    proj_i.lib
EXE_PROJ =    proj.lib
</pre></div>
</div>
<p>以及安装目录 <code class="docutils literal"><span class="pre">INSTDIR</span></code> ,然后开始编译即可</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f makefile.vc
nmake /f makefile.vc install-all
</pre></div>
</div>
</div>
<div class="section" id="libsqlite3">
<h2>libsqlite3<a class="headerlink" href="#libsqlite3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>下载 <code class="docutils literal"><span class="pre">sqlite3</span></code> 源码，放入 <code class="docutils literal"><span class="pre">src</span></code> 目录中。</li>
<li>下载 <a class="reference external" href="https://github.com/snikulov/sqlite.cmake.build">sqliteCmake</a> ,放在 <code class="docutils literal"><span class="pre">src</span></code> 目录上一层</li>
<li>使用cmake编译</li>
</ul>
<p>如下所示，设置安装路径和静态库即可</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G <span class="s2">&quot;Visual Studio 10&quot;</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>f:/gdal/sqlite3  ..
cmake --build . --config Release --target INSTALL
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li>如果需要编译64位的话，第三行需要修改为： <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-G</span> <span class="pre">&quot;Visual</span> <span class="pre">Studio</span> <span class="pre">10</span> <span class="pre">Win64&quot;</span> <span class="pre">..</span></code></li>
</ul>
</div>
</div>
<div class="section" id="libwebp">
<h2>libwebp<a class="headerlink" href="#libwebp" title="Permalink to this headline">¶</a></h2>
<p>静态库，输出在 <code class="docutils literal"><span class="pre">output/release-static/x86</span></code> 中。完成后，拷贝 <code class="docutils literal"><span class="pre">src/webp</span></code> 到 <code class="docutils literal"><span class="pre">include</span></code> 文件夹中。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f Makefile.vc <span class="nv">CFG</span><span class="o">=</span>release-static <span class="nv">RTLIBCFG</span><span class="o">=</span>static <span class="nv">OBJDIR</span><span class="o">=</span>output
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li>如果需要支持WINDOWS XP 的话,libwebp版本不能超过0.4.4,从libwep 0.5开始,不支持windows xp系统</li>
</ul>
</div>
</div>
<div class="section" id="openjpeg">
<h2>openJPEG<a class="headerlink" href="#openjpeg" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G   <span class="s2">&quot;Visual Studio 10&quot;</span> .. -DBUILD_SHARED_LIBS<span class="o">=</span>OFF
                                  -DCMAKE_INSTALL_PREFIX<span class="o">=</span>f:/gdal/openjpeg
                                  -DBUILD_THIRDPARTY<span class="o">=</span>ON ..
cmake --build . --config Release --target INSTALL
</pre></div>
</div>
<p>完成后，添加 <code class="docutils literal"><span class="pre">#define</span> <span class="pre">OPJ_STATIC</span> <span class="pre">1</span></code> 到输出的  <code class="docutils literal"><span class="pre">inlcude/openjpeg-2.0/openjpeg.h</span></code>  里</p>
</div>
<div class="section" id="pcre">
<h2>pcre<a class="headerlink" href="#pcre" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G   <span class="s2">&quot;Visual Studio 10&quot;</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>f:/BUILd/pcre8.41.0_x86 ..
cmake --build . --config Release --target INSTALL
</pre></div>
</div>
<p>完成后需要修改 <code class="docutils literal"><span class="pre">pcre.h</span></code> ,添加 <code class="docutils literal"><span class="pre">#define</span> <span class="pre">PCRE_STATIC</span></code></p>
</div>
<div class="section" id="libkml">
<h2>libKML<a class="headerlink" href="#libkml" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">LibKML</span></code> 需要从 <code class="docutils literal"><span class="pre">github</span></code> 中下最新代码, 找到其中 <code class="docutils literal"><span class="pre">msvc</span></code> 文件夹,打开 <code class="docutils literal"><span class="pre">libkml.sln</span></code> 工程,然后编译即可</p>
<p>第三方库在 <code class="docutils literal"><span class="pre">third_party</span></code> 文件夹中,主要需要编译的只有 <code class="docutils literal"><span class="pre">uriparser-0.7.5.win32</span></code>  <code class="docutils literal"><span class="pre">zlib-1.2.3</span></code> 找到其中sln工程编译即可</p>
</div>
<div class="section" id="spatialite">
<h2>spatialite<a class="headerlink" href="#spatialite" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">spatialite</span></code> 库可以让ogr中使用更多sql函数，方便矢量操作，但是编译比较复杂，依赖很多，需要依次编译 <code class="docutils literal"><span class="pre">libiconv</span> <span class="pre">FreeXL</span> <span class="pre">libxml2</span> <span class="pre">zlib</span> <span class="pre">sqlite3</span> <span class="pre">geos</span> <span class="pre">PROJ.4</span></code> ，后四个库 <code class="docutils literal"><span class="pre">zlib</span> <span class="pre">sqlite3</span> <span class="pre">geos</span> <span class="pre">PROJ.4</span></code> 已经在前面编译完成，可以直接使用，其中 <code class="docutils literal"><span class="pre">zlib</span></code> 在 <code class="docutils literal"><span class="pre">hdf5</span></code> 中编译，然后依次按顺序编译。</p>
<div class="section" id="libiconv">
<h3>libiconv<a class="headerlink" href="#libiconv" title="Permalink to this headline">¶</a></h3>
<p>首先需要编译 <code class="docutils literal"><span class="pre">libiconv</span></code> 库， 2017年更新的1.15版应该可以在windows下编译通过，老的1.11版本也应该可以编译通过，1.15版vs2010工程链接：<a class="reference external" href="http://pan.baidu.com/s/1c2pmVxY">http://pan.baidu.com/s/1c2pmVxY</a> 密码：lypx</p>
<p>直接使用 <a class="reference external" href="https://github.com/holy-shit/iconv-for-windows">iconv for windows</a>  ，里面有 <code class="docutils literal"><span class="pre">vs2010</span></code> 工程文件，也可以直接编译1.14版。</p>
<p>编译完成后，将 <code class="docutils literal"><span class="pre">libiconv.lib``重命名为</span> <span class="pre">``iconv.lib</span></code> ，  <code class="docutils literal"><span class="pre">iconv.obj</span></code> 文件拷至 <code class="docutils literal"><span class="pre">iconv</span></code> 的库目录中,并重命名为 <code class="docutils literal"><span class="pre">lib.obj</span></code> ,后续过程中需要使用</p>
</div>
<div class="section" id="freexl">
<h3>FreeXL<a class="headerlink" href="#freexl" title="Permalink to this headline">¶</a></h3>
<p>下载 <code class="docutils literal"><span class="pre">FreeXL</span></code> 库，修改其中的 <code class="docutils literal"><span class="pre">makefile.vc</span></code> 文件中 <code class="docutils literal"><span class="pre">iconv</span></code> 的 <code class="docutils literal"><span class="pre">include</span></code> 和 <code class="docutils literal"><span class="pre">lib</span></code> 路径</p>
<p>修改 <code class="docutils literal"><span class="pre">src/freexl.c</span></code> 第93-109行，注释掉</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cp">#if defined(_WIN32) &amp;&amp; !defined(__MINGW32__)</span>
<span class="cm">/* MSVC compiler doesn&#39;t support lround() at all */</span>
<span class="cm">/*</span>
<span class="cm">static double</span>
<span class="cm">__declspec(dllexport) round (double num)</span>
<span class="cm">{</span>
<span class="cm">        double integer = ceil (num);</span>
<span class="cm">        if (num &gt; 0)</span>
<span class="cm">        return integer - num &gt; 0.5 ? integer - 1.0 : integer;</span>
<span class="cm">        return integer - num &gt;= 0.5 ? integer - 1.0 : integer;</span>
<span class="cm">}</span>

<span class="cm">static long</span>
<span class="cm">__declspec(dllexport) lround (double num)</span>
<span class="cm">{</span>
<span class="cm">        long integer = (long) round (num);</span>
<span class="cm">        return integer;</span>
<span class="cm">}*/</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>然后再vs命令行中编译</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f Makefile.vc
nmake /f makefile.vc install
</pre></div>
</div>
</div>
<div class="section" id="libxml2">
<h3>libxml2<a class="headerlink" href="#libxml2" title="Permalink to this headline">¶</a></h3>
<p>下载 <code class="docutils literal"><span class="pre">libxml2</span></code> 库，转到目录 <code class="docutils literal"><span class="pre">win32/VC10</span></code> 下,使用 <code class="docutils literal"><span class="pre">libxml2.sln</span></code> 工程编译</p>
<ul class="simple">
<li>编译前,先进入 <code class="docutils literal"><span class="pre">vs2010</span></code> 命令行工具中，在 <code class="docutils literal"><span class="pre">win32</span></code> 目录下,运行  <code class="docutils literal"><span class="pre">cscript</span> <span class="pre">configure.js</span> <span class="pre">help</span></code></li>
<li>按照提示,添加iconv的include目录和iconv目录，运行 <code class="docutils literal"><span class="pre">cscript</span> <span class="pre">configure.js</span>&#160; <span class="pre">static=yes</span> <span class="pre">compiler=msvc</span> <span class="pre">prefix=c:\libxml2</span> <span class="pre">include=c:\iconv\include</span> <span class="pre">lib=c:\iconv\lib</span></code> ，此时在命令行中是无法编译通过的(不做这一步后面sln工程可能无法编译通过)</li>
<li>进入 <code class="docutils literal"><span class="pre">win32/VC10</span></code> 目录中,在 vs x86命令行工具下运行 <code class="docutils literal"><span class="pre">nmake</span> <span class="pre">/f</span> <span class="pre">Makefile.msvc</span> <span class="pre">install</span></code></li>
</ul>
</div>
<div class="section" id="id13">
<h3>spatialite<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>下载 <code class="docutils literal"><span class="pre">spatialite</span></code> 库，编辑 <code class="docutils literal"><span class="pre">nmake.opt</span></code> 文件和 <code class="docutils literal"><span class="pre">makefile.vc</span></code> 文件中各个库的路径和头文件路径,然后在   <code class="docutils literal"><span class="pre">vs2010</span></code> 命令行工具中输入:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f Makefile.vc
nmake /f makefile.vc install
</pre></div>
</div>
<p>编译完成后，将 <code class="docutils literal"><span class="pre">sqlite</span></code> 的头文件拷贝至 <code class="docutils literal"><span class="pre">include/spatialite</span></code> 文件夹中，后续编译将会使用。</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">freexl</span></code> 和 <code class="docutils literal"><span class="pre">spatialite</span></code> 的动态库应该会编译出错,可以忽略掉继续下面步骤</li>
</ul>
</div>
</div>
</div>
<div class="section" id="id14">
<h2>gdal<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>修改nmake.opt文件,注意按照自己实际情况修改</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>    //291行
    <span class="c1"># Uncomment out the following lines to enable LibKML support.</span>
    <span class="c1">#LIBKML_DIR = F:\GDAL_BUILD\libkml-master</span>
    <span class="c1">#LIBKML_INCLUDE = -IF:\GDAL_BUILD\libkml-master\src -IF:\GDAL_BUILD\libkml-master\src\kml -I$(LIBKML_DIR)/third_party/boost_1_34_1</span>
    <span class="c1">#LIBKML_LIBRARY = $(LIBKML_DIR)/msvc/x64/Release</span>
    <span class="c1">#LIBKML_LIBS =  $(LIBKML_LIBRARY)/libkmlbase.lib \</span>
    <span class="c1">#               $(LIBKML_LIBRARY)/libkmlconvenience.lib \</span>
    <span class="c1">#               $(LIBKML_LIBRARY)/libkmldom.lib \</span>
    <span class="c1">#               $(LIBKML_LIBRARY)/libkmlengine.lib \</span>
    <span class="c1">#               $(LIBKML_LIBRARY)/libkmlregionator.lib \</span>
    <span class="c1">#               $(LIBKML_LIBRARY)/libkmlxsd.lib \</span>
    <span class="c1">#               F:\GDAL_BUILD\libkml-master\third_party\zlib-1.2.3\contrib\minizip\x64\Release/minizip_static.lib \</span>
    <span class="c1">#               F:\GDAL_BUILD\libkml-master\third_party\uriparser-0.7.5\win32\Visual_Studio_2005\x64\Release/uriparser.lib</span>
    <span class="c1">#               $(LIBKML_DIR)/third_party\zlib-1.2.3.win32/lib/minizip.lib \</span>
    <span class="c1">#               $(LIBKML_DIR)/third_party\zlib-1.2.3.win32/lib/zlib.lib</span>
    <span class="c1">#               $(LIBKML_DIR)/third_party\expat.win32/libexpat.lib</span>
    //改为,最下面三个不需要,否则会哟重复引用
    <span class="c1"># Uncomment out the following lines to enable LibKML support.</span>
    <span class="nv">LIBKML_DIR</span> <span class="o">=</span> F:<span class="se">\G</span>DAL_BUILD<span class="se">\l</span>ibkml-master
    <span class="nv">LIBKML_INCLUDE</span> <span class="o">=</span> -IF:<span class="se">\G</span>DAL_BUILD<span class="se">\l</span>ibkml-master<span class="se">\s</span>rc -IF:<span class="se">\G</span>DAL_BUILD<span class="se">\l</span>ibkml-master<span class="se">\s</span>rc<span class="se">\k</span>ml -I<span class="k">$(</span>LIBKML_DIR<span class="k">)</span>/third_party/boost_1_34_1
    <span class="nv">LIBKML_LIBRARY</span> <span class="o">=</span> <span class="k">$(</span>LIBKML_DIR<span class="k">)</span>/msvc/Release
    <span class="nv">LIBKML_LIBS</span> <span class="o">=</span>   <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmlbase.lib <span class="se">\</span>
                    <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmlconvenience.lib <span class="se">\</span>
                    <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmldom.lib <span class="se">\</span>
                    <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmlengine.lib <span class="se">\</span>
                    <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmlregionator.lib <span class="se">\</span>
                    <span class="k">$(</span>LIBKML_LIBRARY<span class="k">)</span>/libkmlxsd.lib <span class="se">\</span>
                    F:<span class="se">\G</span>DAL_BUILD<span class="se">\l</span>ibkml-master<span class="se">\t</span>hird_party<span class="se">\z</span>lib-1.2.3<span class="se">\c</span>ontrib<span class="se">\m</span>inizip<span class="se">\R</span>elease/minizip_static.lib <span class="se">\</span>
                    F:<span class="se">\G</span>DAL_BUILD<span class="se">\l</span>ibkml-master<span class="se">\t</span>hird_party<span class="se">\u</span>riparser-0.7.5<span class="se">\w</span>in32<span class="se">\V</span>isual_Studio_2005<span class="se">\R</span>elease/uriparser.lib
    <span class="c1">#               $(LIBKML_DIR)/third_party\zlib-1.2.3.win32/lib/minizip.lib \</span>
    <span class="c1">#               $(LIBKML_DIR)/third_party\zlib-1.2.3.win32/lib/zlib.lib</span>
    <span class="c1">#               $(LIBKML_DIR)/third_party\expat.win32/libexpat.lib</span>

//303行
<span class="c1"># Uncomment for Expat support (required for KML, GPX and GeoRSS read support).</span>
<span class="c1">#EXPAT_DIR = &quot;C:\Program Files\Expat 2.0.1&quot;</span>
<span class="c1">#EXPAT_INCLUDE = -I$(EXPAT_DIR)/source/lib</span>
<span class="c1">#EXPAT_LIB = $(EXPAT_DIR)/bin/libexpat.lib</span>
//改为
<span class="c1"># Uncomment for Expat support (required for KML, GPX and GeoRSS read support).</span>
<span class="nv">EXPAT_DIR</span> <span class="o">=</span>E:<span class="se">\B</span>UILD<span class="se">\l</span>ib<span class="se">\e</span>xpat
<span class="nv">EXPAT_INCLUDE</span> <span class="o">=</span> -I<span class="k">$(</span>EXPAT_DIR<span class="k">)</span>/include
<span class="nv">EXPAT_LIB</span> <span class="o">=</span> E:<span class="se">\B</span>UILD<span class="se">\l</span>ib<span class="se">\e</span>xpat<span class="se">\l</span>ib<span class="se">\e</span>xpat.lib

----------------------------------------------------------------------------------

//331行
<span class="c1"># Uncomment the following and update to enable NCSA HDF Release 4 support.</span>
<span class="c1">#HDF4_PLUGIN = NO</span>
<span class="c1">#HDF4_DIR =    D:\warmerda\HDF41r5</span>
<span class="c1">#HDF4_LIB =    /LIBPATH:$(HDF4_DIR)\lib Ws2_32.lib</span>
//改为
<span class="c1"># Uncomment the following and update to enable NCSA HDF Release 4 support.</span>
<span class="nv">HDF4_PLUGIN</span> <span class="o">=</span> NO
<span class="nv">HDF4_DIR</span> <span class="o">=</span>    E:<span class="se">\B</span>UILD<span class="se">\l</span>ib<span class="se">\4</span>.2.9
<span class="nv">HDF4_LIB</span> <span class="o">=</span>    <span class="k">$(</span>HDF4_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibhdf.lib <span class="k">$(</span>HDF4_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibmfhdf.lib  <span class="se">\</span>
      <span class="k">$(</span>HDF4_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibxdr.lib <span class="k">$(</span>HDF4_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibjpeg.lib  Ws2_32.lib

----------------------------------------------------------------------------------

//336行
<span class="c1"># Uncomment the following and update to enable NCSA HDF Release 5 support.</span>
<span class="c1">#HDF5_PLUGIN = NO</span>
<span class="c1">#HDF5_DIR =    c:\warmerda\supportlibs\hdf5\5-164-win</span>
<span class="c1">#HDF5_LIB =    $(HDF5_DIR)\dll\hdf5dll.lib</span>
//改为
<span class="c1"># Uncomment the following and update to enable NCSA HDF Release 5 support.</span>
<span class="nv">HDF5_PLUGIN</span> <span class="o">=</span> NO
<span class="nv">HDF5_DIR</span> <span class="o">=</span>    E:<span class="se">\B</span>UILD<span class="se">\l</span>ib<span class="se">\1</span>.8.11
<span class="nv">HDF5_LIB</span> <span class="o">=</span>    <span class="k">$(</span>HDF5_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibhdf5.lib <span class="k">$(</span>HDF5_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibhdf5_hl.lib <span class="se">\</span>
     <span class="k">$(</span>HDF5_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibszip.lib <span class="k">$(</span>HDF5_DIR<span class="k">)</span><span class="se">\l</span>ib<span class="se">\l</span>ibzlib.lib

----------------------------------------------------------------------------------
----------------------------------------------------------------------------------

//387行
<span class="c1"># SQLite Libraries</span>
<span class="c1">#SQLITE_INC=-IN:\pkg\sqlite-win32</span>
<span class="c1">#SQLITE_LIB=N:\pkg\sqlite-win32\sqlite3_i.lib</span>
//改为
<span class="c1"># SQLite Libraries</span>
<span class="nv">SQLITE_INC</span><span class="o">=</span>-If:<span class="se">\G</span>DAL<span class="se">\l</span>ibsqlite3<span class="se">\i</span>nclude
<span class="nv">SQLITE_LIB</span><span class="o">=</span>f:<span class="se">\G</span>DAL<span class="se">\l</span>ibsqlite3<span class="se">\l</span>ib<span class="se">\s</span>qlite3.lib

//如果是使用spatialite,那么需要修改上面的注释
<span class="c1"># SQLite Libraries</span>
<span class="c1">#SQLITE_INC=-IN:\pkg\sqlite-win32</span>
<span class="c1">#SQLITE_LIB=N:\pkg\sqlite-win32\sqlite3_i.lib</span>
<span class="c1"># For spatialite support, try this instead (assuming you grab the \</span>
    libspatialite-amalgamation-2.3.1 and installed it in osgeo4w<span class="o">)</span>:
<span class="c1"># The -DSPATIALITE_AMALGAMATION, which cause &quot;spatialite/sqlite3.h&quot; \</span>
    to be included instead of <span class="s2">&quot;sqlite3.h&quot;</span> might not be necessary
<span class="c1"># depending on the layout of the include directories. In case of compilation errors,\</span>
    remove it.
<span class="c1">#SQLITE_INC=-IC:\osgeo4w\include -DHAVE_SPATIALITE -DSPATIALITE_AMALGAMATION</span>
<span class="c1">#SQLITE_LIB=C:\osgeo4w\lib\spatialite_i.lib</span>
<span class="c1"># Uncomment following line if libsqlite3 has been compiled with \</span>
    <span class="nv">SQLITE_HAS_COLUMN_METADATA</span><span class="o">=</span>yes
<span class="c1">#SQLITE_HAS_COLUMN_METADATA=yes</span>
<span class="c1"># Uncomment following line if spatialite is 4.1.2 or later</span>
<span class="c1">#SPATIALITE_412_OR_LATER=yes</span>
//改为
<span class="c1"># SQLite Libraries</span>
<span class="c1">#SQLITE_INC=-ID:\GDAL\sqlite3.13\include</span>
<span class="c1">#SQLITE_LIB=D:\GDAL\sqlite3.13\lib\sqlite3-static.lib</span>
<span class="c1"># For spatialite support, try this instead</span>
<span class="c1"># (assuming you grab the libspatialite-amalgamation-2.3.1 and installed it in osgeo4w):</span>
<span class="c1"># The -DSPATIALITE_AMALGAMATION, which cause &quot;spatialite/sqlite3.h&quot;  \</span>
    to be included instead of <span class="s2">&quot;sqlite3.h&quot;</span> might not be necessary
<span class="c1"># depending on the layout of the include directories. In case of compilation errors,\</span>
    remove it.
<span class="nv">SQLITE_INC</span><span class="o">=</span>-IC:<span class="se">\O</span>SGeo4w<span class="se">\l</span>ibspatialite<span class="se">\i</span>nclude <span class="se">\</span>
            -DHAVE_SPATIALITE -DSPATIALITE_AMALGAMATION
<span class="nv">SQLITE_LIB</span><span class="o">=</span>C:<span class="se">\O</span>SGeo4w<span class="se">\l</span>ibspatialite<span class="se">\l</span>ib<span class="se">\s</span>patialite.lib <span class="se">\</span>
    <span class="s2">&quot;C:\OSGeo4w\libspatialite\lib\sqlite3-static.lib&quot;</span>  <span class="se">\</span>
    <span class="s2">&quot;C:\OSGeo4w\libspatialite\lib\libxml2.lib&quot;</span> <span class="se">\</span>
    <span class="s2">&quot;C:\OSGeo4w\libspatialite\lib\iconv.lib&quot;</span>
<span class="c1"># Uncomment following line if libsqlite3 has been compiled \</span>
    with <span class="nv">SQLITE_HAS_COLUMN_METADATA</span><span class="o">=</span>yes
<span class="c1">#SQLITE_HAS_COLUMN_METADATA=yes</span>
<span class="c1"># Uncomment following line if spatialite is 4.1.2 or later</span>
<span class="nv">SPATIALITE_412_OR_LATER</span><span class="o">=</span>yes

----------------------------------------------------------------------------------
----------------------------------------------------------------------------------

//401行
<span class="c1"># PCRE Library (REGEXP support for SQLite) for example from \</span>
    http://sourceforge.net/projects/gnuwin32/files/pcre/7.0/pcre-7.0.exe/download
<span class="c1">#PCRE_INC=-I&quot;C:\Program Files\GNUWin32\include&quot; -DHAVE_PCRE</span>
<span class="c1">#PCRE_LIB=&quot;C:\Program Files\GNUWin32\lib\pcre.lib&quot;</span>
//改为
<span class="c1"># PCRE Library (REGEXP support for SQLite) for example from \</span>
    http://sourceforge.net/projects/gnuwin32/files/pcre/7.0/pcre-7.0.exe/download
<span class="nv">PCRE_INC</span><span class="o">=</span>-I<span class="s2">&quot;e:\BUILD\lib\PCRE\include&quot;</span> -DHAVE_PCRE
<span class="nv">PCRE_LIB</span><span class="o">=</span><span class="s2">&quot;e:\BUILD\lib\PCRE\lib\pcre.lib&quot;</span>

----------------------------------------------------------------------------------
//420行
<span class="c1"># Uncomment the following to enable NetCDF format.</span>
<span class="c1">#NETCDF_PLUGIN = NO</span>
<span class="c1">#NETCDF_SETTING=yes</span>
<span class="c1">#NETCDF_LIB=C:\Software\netcdf\lib\netcdf.lib</span>
<span class="c1">#NETCDF_INC_DIR=C:\Software\netcdf\include</span>

<span class="c1"># Uncomment the following to add NC4 and HDF4 support</span>
<span class="c1">#NETCDF_HAS_NC4 = yes</span>
<span class="c1">#NETCDF_HAS_HDF4 = yes</span>

<span class="c1"># PROJ.4 stuff</span>
<span class="c1"># Uncomment the following lines to link PROJ.4 library statically. Otherwise</span>
<span class="c1"># it will be linked dynamically during runtime.</span>
<span class="c1">#PROJ_FLAGS = -DPROJ_STATIC</span>
<span class="c1">#PROJ_INCLUDE = -Id:\projects\proj.4\src</span>
<span class="c1">#PROJ_LIBRARY = d:\projects\proj.4\src\proj_i.lib</span>
//改为
<span class="c1"># Uncomment the following to enable NetCDF format.</span>
<span class="nv">NETCDF_PLUGIN</span> <span class="o">=</span> NO
<span class="nv">NETCDF_SETTING</span><span class="o">=</span>yes
<span class="nv">NETCDF_LIB</span><span class="o">=</span>E:<span class="se">\B</span>UILD<span class="se">\n</span>etcdf<span class="se">\l</span>ib<span class="se">\n</span>etcdf.lib
<span class="nv">NETCDF_INC_DIR</span><span class="o">=</span>E:<span class="se">\B</span>UILD<span class="se">\n</span>etcdf<span class="se">\i</span>nclude

<span class="c1"># Uncomment the following to add NC4 and HDF4 support</span>
<span class="nv">NETCDF_HAS_NC4</span> <span class="o">=</span> yes
<span class="c1">#NETCDF_HAS_HDF4 = yes</span>

<span class="c1"># PROJ.4 stuff</span>
<span class="c1"># Uncomment the following lines to link PROJ.4 library statically. Otherwise</span>
<span class="c1"># it will be linked dynamically during runtime.</span>
<span class="nv">PROJ_FLAGS</span> <span class="o">=</span> -DPROJ_STATIC
<span class="nv">PROJ_INCLUDE</span> <span class="o">=</span> -IC:<span class="se">\P</span>ROJ<span class="se">\i</span>nclude
<span class="nv">PROJ_LIBRARY</span> <span class="o">=</span> c:<span class="se">\P</span>ROJ<span class="se">\l</span>ib<span class="se">\p</span>roj.lib

----------------------------------------------------------------------------------

//479行
<span class="c1"># Uncomment to use libcurl (DLL by default)</span>
<span class="c1"># The cURL library is used for WCS, WMS, GeoJSON, SRS call importFromUrl(),\</span>
    WFS, GFT, CouchDB, /vsicurl/ etc.
<span class="c1">#CURL_DIR=C:\curl-7.15.0</span>
<span class="c1">#CURL_INC = -I$(CURL_DIR)/include</span>
<span class="c1"># Uncoment following line to use libcurl as dynamic library</span>
<span class="c1">#CURL_LIB = $(CURL_DIR)/libcurl_imp.lib wsock32.lib wldap32.lib winmm.lib</span>
<span class="c1"># Uncoment following two lines to use libcurl as static library</span>
<span class="c1">#CURL_LIB = $(CURL_DIR)/libcurl.lib wsock32.lib wldap32.lib winmm.lib</span>
<span class="c1">#CURL_CFLAGS = -DCURL_STATICLIB</span>
//改为
<span class="c1"># Uncomment to use libcurl (DLL by default)</span>
<span class="c1"># The cURL library is used for WCS, WMS, GeoJSON, SRS call importFromUrl(),\</span>
    WFS, GFT, CouchDB, /vsicurl/ etc.
<span class="nv">CURL_DIR</span><span class="o">=</span>E:<span class="se">\B</span>UILD<span class="se">\l</span>ib<span class="se">\l</span>ibcurl
<span class="nv">CURL_INC</span> <span class="o">=</span> -I<span class="k">$(</span>CURL_DIR<span class="k">)</span>/include
<span class="c1"># Uncoment following line to use libcurl as dynamic library</span>
<span class="c1">#CURL_LIB = $(CURL_DIR)/libcurl_imp.lib wsock32.lib wldap32.lib winmm.lib</span>
<span class="c1"># Uncoment following two lines to use libcurl as static library</span>
<span class="nv">CURL_LIB</span> <span class="o">=</span> <span class="k">$(</span>CURL_DIR<span class="k">)</span>/lib/libcurl_a.lib wsock32.lib wldap32.lib winmm.lib
<span class="nv">CURL_CFLAGS</span> <span class="o">=</span> -DCURL_STATICLIB

----------------------------------------------------------------------------------

//495行
<span class="c1"># Uncomment for GEOS support (GEOS &gt;= 3.1.0 required)</span>
<span class="c1">#GEOS_DIR=C:/warmerda/geos</span>
<span class="c1">#GEOS_CFLAGS = -I$(GEOS_DIR)/capi -I$(GEOS_DIR)/source/headers -DHAVE_GEOS</span>
<span class="c1">#GEOS_LIB     = $(GEOS_DIR)/source/geos_c_i.lib</span>

//改为
<span class="c1"># Uncomment for GEOS support (GEOS &gt;= 3.1.0 required)</span>
<span class="nv">GEOS_DIR</span><span class="o">=</span>e:<span class="se">\B</span>UILD<span class="se">\g</span>eos-3.4.2
<span class="nv">GEOS_CFLAGS</span> <span class="o">=</span> -I<span class="k">$(</span>GEOS_DIR<span class="k">)</span>/capi -I<span class="k">$(</span>GEOS_DIR<span class="k">)</span>/include -DHAVE_GEOS
<span class="nv">GEOS_LIB</span>     <span class="o">=</span> <span class="k">$(</span>GEOS_DIR<span class="k">)</span>/src/geos.lib

----------------------------------------------------------------------------------

//505行
<span class="c1"># Uncomment for OpenJpeg (release v2.0.0) support</span>
<span class="c1">#OPENJPEG_ENABLED = YES</span>
<span class="c1">#OPENJPEG_CFLAGS = -IC:\openjpeg\include</span>
<span class="c1">#OPENJPEG_LIB = C:\openjpeg\lib\openjpeg.lib</span>

//改为
<span class="c1"># Uncomment for OpenJpeg (release v2.0.0) support</span>
<span class="nv">OPENJPEG_ENABLED</span> <span class="o">=</span> YES
<span class="nv">OPENJPEG_CFLAGS</span> <span class="o">=</span> -If:<span class="se">\G</span>DAL<span class="se">\o</span>penjpeg<span class="se">\i</span>nclude
<span class="nv">OPENJPEG_LIB</span> <span class="o">=</span> f:<span class="se">\G</span>DAL<span class="se">\o</span>penjpeg<span class="se">\l</span>ib<span class="se">\o</span>penjp2.lib

----------------------------------------------------------------------------------

//530行
<span class="c1"># Uncomment for WEBP support</span>
<span class="c1">#WEBP_ENABLED = YES</span>
<span class="c1">#WEBP_CFLAGS = -IE:/libwebp-0.1-windows/dev/Include</span>
<span class="c1">#WEBP_LIBS = e:/libwebp-0.1-windows/dev/lib/libwebp_a.lib</span>

//改为
<span class="c1"># Uncomment for WEBP support</span>
<span class="nv">WEBP_ENABLED</span> <span class="o">=</span> YES
<span class="nv">WEBP_CFLAGS</span> <span class="o">=</span> -IF:<span class="se">\G</span>DAL<span class="se">\l</span>ibwebp-0.3.1<span class="se">\s</span>rc
<span class="nv">WEBP_LIBS</span> <span class="o">=</span> f:<span class="se">\G</span>DAL<span class="se">\l</span>ibwebp<span class="se">\l</span>ib<span class="se">\l</span>ibwebp.lib

----------------------------------------------------------------------------------

//591行
<span class="nv">LINKER_FLAGS</span> <span class="o">=</span> <span class="k">$(</span>EXTRA_LINKER_FLAGS<span class="k">)</span> <span class="k">$(</span>MSVC_VLD_LIB<span class="k">)</span> <span class="k">$(</span>LDEBUG<span class="k">)</span>

//改为,防止openjepg库链接出错
<span class="nv">LINKER_FLAGS</span> <span class="o">=</span> <span class="k">$(</span>EXTRA_LINKER_FLAGS<span class="k">)</span> <span class="k">$(</span>MSVC_VLD_LIB<span class="k">)</span> <span class="k">$(</span>LDEBUG<span class="k">)</span> /NODEFAULTLIB:LIBCMT
</pre></div>
</div>
<p>需要中文路径支持，请参看 <a class="reference external" href="http://blog.csdn.net/liminlu0314/article/details/6610069">关于GDAL180中文路径不能打开的问题分析与解决</a></p>
<p>我选择的是方案2,
修改 <code class="docutils literal"><span class="pre">GDAL_HOME\frmts\gdalallregister.cpp</span></code> 文件73行左右， <code class="docutils literal"><span class="pre">GDALAllRegister()</span></code> 函数，以及 <code class="docutils literal"><span class="pre">GDAL_HOME\ogr\ogrsf_frmts\generic\ogrregisterall.cpp</span></code> 38行左右， <code class="docutils literal"><span class="pre">OGRRegisterAll()</span></code> 函数，在函数最前面添加</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="n">CPLSetConfigOption</span><span class="p">(</span><span class="s">&quot;GDAL_FILENAME_IS_UTF8&quot;</span><span class="p">,</span><span class="s">&quot;NO&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>然后使用nmake即可，需要debug的话，加上参数 <code class="docutils literal"><span class="pre">debug=1</span></code></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmake /f makefile.vc
nmake /f makefile.vc devinstall
</pre></div>
</div>
<p>如果需要64位，请修改153行左右， <code class="docutils literal"><span class="pre">#WIN64=YES</span></code> 为 <code class="docutils literal"><span class="pre">WIN64=YES</span></code></p>
<p><code class="docutils literal"><span class="pre">GDAL</span> <span class="pre">2.0</span></code> 的版本中,某些gtiff的文件投影默认读不出来,需要添加 <code class="docutils literal"><span class="pre">GDAL_DATA</span></code> 环境变量,也可以删除 <code class="docutils literal"><span class="pre">\frmts\gtiff\gt_wkt_srs.cpp</span></code> 中 716-733行, <code class="docutils literal"><span class="pre">GDAL</span> <span class="pre">dev</span></code> 中已经修复, <a class="reference external" href="https://trac.osgeo.org/gdal/ticket/6210">Ticket 6210</a>  :</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span> <span class="n">psDefn</span><span class="o">-&gt;</span><span class="n">Model</span> <span class="o">==</span> <span class="n">ModelTypeProjected</span> <span class="o">&amp;&amp;</span>
    <span class="n">psDefn</span><span class="o">-&gt;</span><span class="n">PCS</span> <span class="o">!=</span> <span class="n">KvUserDefined</span> <span class="o">&amp;&amp;</span>
    <span class="n">GDALGTIFKeyGetSHORT</span><span class="p">(</span><span class="n">hGTIF</span><span class="p">,</span> <span class="n">ProjectionGeoKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">GDALGTIFKeyGetSHORT</span><span class="p">(</span><span class="n">hGTIF</span><span class="p">,</span> <span class="n">ProjCoordTransGeoKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">GDALGTIFKeyGetSHORT</span><span class="p">(</span><span class="n">hGTIF</span><span class="p">,</span> <span class="n">GeographicTypeGeoKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">GDALGTIFKeyGetSHORT</span><span class="p">(</span><span class="n">hGTIF</span><span class="p">,</span> <span class="n">GeogGeodeticDatumGeoKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">GDALGTIFKeyGetSHORT</span><span class="p">(</span><span class="n">hGTIF</span><span class="p">,</span> <span class="n">GeogEllipsoidGeoKey</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">CSLTestBoolean</span><span class="p">(</span><span class="n">CPLGetConfigOption</span><span class="p">(</span><span class="s">&quot;GTIFF_IMPORT_FROM_EPSG&quot;</span><span class="p">,</span> <span class="s">&quot;YES&quot;</span><span class="p">))</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Save error state as importFromEPSGA() will call CPLReset()</span>
    <span class="kt">int</span> <span class="n">errNo</span> <span class="o">=</span> <span class="n">CPLGetLastErrorNo</span><span class="p">();</span>
    <span class="n">CPLErr</span> <span class="n">eErr</span> <span class="o">=</span> <span class="n">CPLGetLastErrorType</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pszTmp</span> <span class="o">=</span> <span class="n">CPLGetLastErrorMsg</span><span class="p">();</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">pszLastErrorMsg</span> <span class="o">=</span> <span class="n">CPLStrdup</span><span class="p">(</span><span class="n">pszTmp</span> <span class="o">?</span> <span class="nl">pszTmp</span> <span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="n">CPLPushErrorHandler</span><span class="p">(</span><span class="n">CPLQuietErrorHandler</span><span class="p">);</span>
    <span class="n">OGRErr</span> <span class="n">eImportErr</span> <span class="o">=</span> <span class="n">oSRS</span><span class="p">.</span><span class="n">importFromEPSG</span><span class="p">(</span><span class="n">psDefn</span><span class="o">-&gt;</span><span class="n">PCS</span><span class="p">);</span>
    <span class="n">CPLPopErrorHandler</span><span class="p">();</span>
    <span class="c1">// Restore error state</span>
    <span class="n">CPLErrorSetState</span><span class="p">(</span> <span class="n">eErr</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">pszLastErrorMsg</span><span class="p">);</span>
    <span class="n">CPLFree</span><span class="p">(</span><span class="n">pszLastErrorMsg</span><span class="p">);</span>
    <span class="n">bGotFromEPSG</span> <span class="o">=</span> <span class="p">(</span><span class="n">eImportErr</span> <span class="o">==</span> <span class="n">OGRERR_NONE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h2>编译结果下载<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>放在百度网盘里，有hdf4、hdf5、curl、expat、gdal等，会更新，需要者自取。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://pan.baidu.com/s/13R6i5">编译完成的库</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ogr-architecture.html" class="btn btn-neutral float-right" title="OGR矢量结构" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gdal-warp-api-tutorial.html" class="btn btn-neutral" title="GDALWarp" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2018, wuqi.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>